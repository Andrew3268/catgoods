<br>
<div class="detail_wrap clearfix">
  <p class="info_title">상세정보</p>
  
   <div class="detail_box detail_nutri clearfix">

    <div class="basic_info clearfix">
      <div class="bi_box">        
        <%= render 'jibsas/codes_country' %>
        <p class="info_p">제조국가</p>
      </div>
      <div class="bi_box">        
        <%= render 'jibsas/codes_country' %>
        <p class="info_p">원산지</p>
      </div>
      <div class="bi_box">        
        <% if @jibsa.j_option_01 == 101 %>
          <span>건식사료</span>
        <% elsif @jibsa.j_option_01 == 102 %>
          <span>습식사료</span>
        <% elsif @jibsa.j_option_01 == 103 %>
          <span>동결건조</span>
        <% end %>
        <p class="info_p">사료타입</p>
      </div>
      <div class="bi_box">        
        <%= render 'jibsas/codes_ingredient' %>
        <p class="info_p">제1주 원료</p>
      </div>
    </div>

    
    <% dm_protein = 0 %>
    <% dm_protein =  100 * @jibsa.j_option_11.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>

    <% dm_fat = 0 %>
    <% dm_fat =  100 * @jibsa.j_option_14.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
  
    <% dm_calcium = 0 %>
    <% dm_calcium =  100 * @jibsa.j_option_15.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
  
    <% dm_phosphorus = 0 %>
    <% dm_phosphorus =  100 * @jibsa.j_option_16.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
    

    <div class="basic_info clearfix">
      <div class="bi_box">        
        <% if dm_protein > 26 && dm_fat > 9 && dm_calcium > 0.6 && dm_phosphorus > 0.5 %>
          <span>충족</span>
        <% else %>
          <span>불충족</span>
        <% end %>
        <p class="info_p">AAFCO 기준</p>
      </div>
      <div class="bi_box">        
        <span>있음</span>
        <p class="info_p">생산 공장</p>
      </div>
      <div class="bi_box">        
        <span>있음</span>
        <p class="info_p">자체 연구소</p>
      </div>
      <div class="bi_box">        
        <span>없음</span>
        <p class="info_p">리콜이력</p>
      </div>
    </div>


    <div class="basic_infomation">
      <div class="infom_box">
        <span>제조 국가</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>원산지</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>급여 대상</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>사료 타입</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>주 단백질원</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>그레인프리</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>자체 생산시설</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>자체 연구소</span>
        <p>한국</p>
      </div>

      <div class="infom_box">
        <span>리콜 이력</span>
        <p>한국</p>
      </div>
    </div>

    

    <!-- <p class="info_title">상세정보</p> -->
    <br />
  
    <div class="expection_effects">
      <h4>기대 효과</h4>
      <%= render 'jibsas/codes_functional' %>
    </div>

  </div><!-- detail_box -->


    
    
  <br><br>


  <div class="nutrition_box detail_nutri clearfix">
    <div class="main-container">
        
            <div class="title_box">
              <h2>영양소 분석</h2>
            </div> 

            <div class="graph_wrap">   
              <h2>Horizontal Bar Chart</h2>
              <div class="barGraph">
                <ul class="graph">
                  <span class="graph-barBack">
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_11 %>">
                      <span class="graph-legend">조단백질</span>
                    </li>
                  </span>  

                  <span class="graph-barBack">    
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_14 %>">
                      <span class="graph-legend">조지방</span>
                    </li>
                  </span>

                  <span class="graph-barBack">    
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_18 %>">
                      <span class="graph-legend">조회분</span>
                    </li>
                  </span>

                  <span class="graph-barBack">    
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_17 %>">
                      <span class="graph-legend">조섬유</span>
                    </li>
                  </span>

                  <span class="graph-barBack">    
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_15 %>">
                      <span class="graph-legend">칼슘</span>
                    </li>
                  </span>

                  <span class="graph-barBack">    
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_16 %>">
                      <span class="graph-legend">인</span>
                    </li>
                  </span>      

                  <span class="graph-barBack">    
                    <li class="graph-bar" data-value="<%= @jibsa.j_option_12 %>">
                      <span class="graph-legend">수분</span>
                    </li>
                  </span>      
                </ul>
              </div>
            </div><!-- graph_wrap -->

            <div>
              <% dm_ca_phos_ratio = 0 %>
              <% dm_ca_phos_ratio = dm_phosphorus / dm_calcium %>
              <% carbo_blance = 0 %>
              <% carbo_blance =  100 - @jibsa.j_option_11.to_f - @jibsa.j_option_14.to_f - @jibsa.j_option_12.to_f - @jibsa.j_option_17.to_f - @jibsa.j_option_18.to_f %>
              <div class="ratio_box clearfix">
                <div class="left_ratio comm_ratio">
                  <h3>칼슘 인 비율</h3>
                  <p>1 : <%= number_with_precision(dm_ca_phos_ratio, precision: 2) %></p>
                </div>
                <div class="right_ratio comm_ratio">
                  <h3>탄수화물 함량</h3>
                  <p><%= number_to_percentage(carbo_blance, precision: 2) %></p>
                </div>
              </div>
            </div>


            <main class="main">
              <div class="tab_container">
                <% if @jibsa.j_option_02 == 201 %>
                  <h3>AAFCO 임신·성장기 기준</h3>
                  <p>JellyPaw는 미국사료관리협회인 AAFCO가 제시하는 필수 영양소의 최소 요구량을 기준으로 영양성분을 분석하여 결과를 알려드립니다.</p>
                <% else %>
                  <h3>AAFCO 성숙기(성묘) 기준</h3>
                  <p>JellyPaw는 미국사료관리협회인 AAFCO가 제시하는 필수 영양소의 최소 요구량을 기준으로 영양성분을 분석하여 결과를 알려드립니다.</p>
                <% end %>
                
                <div class="tab">
                  <div class="tab-menu">
                    <button class="tab-menu-link is-active" data-content="item-1">
                      <span data-title="item-1">수분 포함</span>
                    </button>
                    <button class="tab-menu-link" data-content="item-2">
                      <span data-title="item-2">수분 제거</span>
                    </button>
                  </div>
                  
                  <div class="tab-bar">
                    <div class="tab-bar-content is-active" id="item-1">
                      <div class="texts">
                        <div class="nutri_report clearfix">
                          <table>
                            <tr>
                              <td><span><em></em>조단백질</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_11, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>조회분</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_18, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>칼슘</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_15, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>수분</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_12, precision: 1) %></span></td>
                            </tr>
                          </table>

                          <table>
                            <tr>
                              <td><span><em></em>조지방</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_14, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>조섬유</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_17, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>인</span></td>
                              <td><span><%= number_to_percentage(@jibsa.j_option_16, precision: 1) %></span></td>
                            </tr>
                            <!-- <tr>
                              <td><span>인</span></td>
                              <td><span>0.6%</span></td>
                            </tr> -->
                          </table>
                        </div><!-- nutri_report -->
                        
                      </div>
                    </div>

                    <div class="tab-bar-content" id="item-2">
                      <div class="texts">
                      <!-- MD 조단백질 --->
                      <% dm_protein = 0 %>
                      <% dm_protein =  100 * @jibsa.j_option_11.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
                      <!-- MD 조지방 --->
                      <% dm_fat = 0 %>
                      <% dm_fat =  100 * @jibsa.j_option_14.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
                      <!-- MD 칼슘 --->
                      <% dm_calcium = 0 %>
                      <% dm_calcium =  100 * @jibsa.j_option_15.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
                      <!-- MD 인 --->
                      <% dm_phosphorus = 0 %>
                      <% dm_phosphorus =  100 * @jibsa.j_option_16.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
                      <!-- MD 조섬유 --->
                      <% dm_fiber = 0 %>
                      <% dm_fiber =  100 * @jibsa.j_option_17.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>
                      <!-- MD 조회분 --->
                      <% dm_flour = 0 %>
                      <% dm_flour =  100 * @jibsa.j_option_18.to_f / (100 - @jibsa.j_option_12.to_f) * 4000 / @jibsa.j_option_13.to_f %>

                        <div class="nutri_report clearfix">
                          <table>
                            <tr>
                              <td><span><em></em>조단백질</span></td>
                              <% if dm_protein > 26 %>
                                <td><span class="over"><%= number_to_percentage(dm_protein, precision: 1) %></span></td>
                              <% else %>
                                <td><span class="lower"><%= number_to_percentage(dm_protein, precision: 1) %></span></td>
                              <% end %>
                            </tr>
                            <tr>
                              <td><span><em></em>조회분</span></td>
                              <td><span><%= number_to_percentage(dm_flour, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>칼슘</span></td>
                              <% if dm_calcium > 0.6 %>
                                <td><span class="over"><%= number_to_percentage(dm_calcium, precision: 1) %></span></td>
                              <% else %>
                                <td><span class="lower"><%= number_to_percentage(dm_calcium, precision: 1) %></span></td>
                              <% end %>
                              
                            </tr>
                            <tr>
                              <td><span><em></em>수분</span></td>
                              <td><span>0.0%</span></td>
                            </tr>
                          </table>

                          <table>
                            <tr>
                              <td><span><em></em>조지방</span></td>
                              <% if dm_fat > 9 %>
                                <td><span class="over"><%= number_to_percentage(dm_fat, precision: 1) %></span></td>
                              <% else %>
                                <td><span class="lower"><%= number_to_percentage(dm_fat, precision: 1) %></span></td>
                              <% end %>
                              
                            </tr>
                            <tr>
                              <td><span><em></em>조섬유</span></td>
                              <td><span><%= number_to_percentage(dm_fiber, precision: 1) %></span></td>
                            </tr>
                            <tr>
                              <td><span><em></em>인</span></td>
                              <% if dm_phosphorus > 0.5 %>
                                <td><span class="over"><%= number_to_percentage(dm_phosphorus, precision: 1) %></span></td>
                              <% else %>
                                <td><span class="lower"><%= number_to_percentage(dm_phosphorus, precision: 1) %></span></td>
                              <% end %>
                              
                            </tr>
                            <!-- <tr>
                              <td><span>인</span></td>
                              <td><span>0.6%</span></td>
                            </tr> -->
                          </table>
                        </div><!-- nutri_report -->
                        
                      </div>
                    </div>

                  </div>
                </div>
              </div>
            </main>

      </div><!-- main-container -->

    


    <br/><br/>

   
  </div><!-- nutrition_box -->


</div>
<br>
<br>
<!-- 주원료, 알러지 가능성 및 주의 성분 탭 메뉴 -->
<script type="text/javascript">
  $(document).ready(function() {
    $("div.bhoechie-tab-menu>div.list-group>a").click(function(e) {
        e.preventDefault();
        $(this).siblings('a.active').removeClass("active");
        $(this).addClass("active");
        var index = $(this).index();
        $("div.bhoechie-tab>div.bhoechie-tab-content").removeClass("active");
        $("div.bhoechie-tab>div.bhoechie-tab-content").eq(index).addClass("active");
    });
  });
</script>

<!-- 차트 -->
<script type="text/javascript">
  // Produces width of .barChart
  $(document).ready(function() {
    $('.graph-bar').each(function() {
       var dataWidth = $(this).data('value');
       $(this).css("width", dataWidth + "%");
    });
  });
</script>


<!-- 영양소 탭 메뉴 -->
<script type="text/javascript">
  // Tabs Action
    const tabLink = document.querySelectorAll(".tab-menu-link");
    const tabContent = document.querySelectorAll(".tab-bar-content");

    tabLink.forEach((item) => {
      item.addEventListener("click", activeTab);
    });

    function activeTab(item) {
      const btnTarget = item.currentTarget;
      const content = btnTarget.dataset.content;

      tabContent.forEach((item) => {
        item.classList.remove("is-active");
      });

      tabLink.forEach((item) => {
        item.classList.remove("is-active");
      });

      document.querySelector("#" + content).classList.add("is-active");
      btnTarget.classList.add("is-active");
    }

</script>